---
title: "Regularization in Phylogenetic Comparative Discrete Character Models"
author: "James Boyko"
date: "2024-03-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Regularization

Regularization is

Here I will demonstrate it's effect on discrete character evolution using corHMM. I utilize a tool in development (corHMM Dredge) to demonstrate the importance of regularization.

```{r run, cache=TRUE}
library(corHMM)
data(primates)
phy <- multi2di(primates[[1]])
data <- primates[[2]]
corhmm_fit <- corHMM(phy = phy, data = data, rate.cat = 1)
corhmm_fit_dredge <- corHMM:::corHMMDredge(phy = phy, data = data, 1, pen_type = "l1")
```

## Calculate profile likeihoods for the 4 estimated parameteres

Here we are going to sample a factor of 10000 above and below the MLE for each parameters. We're only going to sample 20 points, but as you will see this will still demonstrate the necessity of regularization.

```{r profile, cache=TRUE}
corhmm_profile <- corHMM:::get_batch_profile_lik(corhmm_obj = corhmm_fit,
                                                 range_factor = 10000,
                                                 n_points = 20,
                                                 ncores = 10,
                                                 dredge = FALSE)

dredge_profile <- corHMM:::get_batch_profile_lik(corhmm_obj = corhmm_fit_dredge,
                                                 range_factor = 10000,
                                                 n_points = 20,
                                                 ncores = 10,
                                                 dredge = TRUE)
```

## Plot profile likeihoods for the 4 estimated parameteres

```{r plot_batch, echo=FALSE, fig.width=8, fig.height=6}
print("unregularized result")
corHMM:::plot_batch_profile_lik(corhmm_profile, ylim = c(-55, -40))
print("regularized result")
corHMM:::plot_batch_profile_lik(dredge_profile, ylim = c(-55, -40))
```

## Further examine and demonstrate that within 95% confidence intervals are unreasonable values.

```{r}
print("cool")
```
